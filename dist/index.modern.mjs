function t(){return t=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},t.apply(this,arguments)}function e(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){return{}}return t}class i{constructor(){this.map=new Map}getCallbacks(t){return this.map.get(t)||[]}removeCallback(t,e){const i=this.map.get(t)||[];if(!i)return;if(!e)return void this.map.delete(t);const s=i.indexOf(e);-1!==s&&i.splice(s,1),0===i.length?this.map.delete(t):this.map.set(t,i)}shiftCallback(t){const e=this.getCallbacks(t);if(0===e.length)return;const i=e.shift();return this.removeCallback(t,i),i}storeCallback(t,e){const i=this.map.get(t)||[];i.push(e),this.map.set(t,i)}}class s{constructor(t){this.iframe=void 0,this.callbackStore=void 0,this.guid=void 0,this.messageHandler=void 0,this.originUrl=void 0,this.origin="*",this.readyPromise=void 0,this.version=3,this.iframe=t,this.originUrl=new URL(this.iframe.src).origin,this.guid=crypto.randomUUID(),this.callbackStore=new i,this.readyPromise=new Promise(t=>{this.messageHandler=i=>{if(i.origin!==this.originUrl)return;const s=e(i.data);return(null==s?void 0:s.version)!==this.version||"handshake"===(null==s?void 0:s.action)&&(null==s?void 0:s.guid)!==this.guid?void 0:"ready"===(null==s?void 0:s.action)||"handshake"===(null==s?void 0:s.action)?(this.origin=i.origin,void t()):void this.processData(s)},window.addEventListener("message",this.messageHandler)}),this.postMessage({action:"handshake",guid:this.guid})}addEventListener(t,e){if(!t)throw new TypeError("You must pass an event name.");if(!e)throw new TypeError("You must pass a callback function.");if("function"!=typeof e)throw new TypeError("The callback must be a function.");0===this.callbackStore.getCallbacks(`event:${t}`).length&&this.readyPromise.then(()=>{this.postMessage({action:"event",guid:this.guid,name:t,value:"add"})}),this.callbackStore.storeCallback(`event:${t}`,e)}destroy(){this.messageHandler&&window.removeEventListener("message",this.messageHandler),this.postMessage({action:"command",guid:this.guid,name:"destroy"})}disableCaptionTrack(){this.enableCaptionTrack(null)}enableCaptionTrack(t){this.set("captionTrack",t)}async getCaptionTracks(){return this.get("captionTracks")}async getChapter(){return this.get("chapter")}async getChapters(){return this.get("chapters")}async getCurrentCaptionTrack(){return this.get("captionTrack")}async getCurrentTime(){return this.get("currentTime")}async getDuration(){return this.get("duration")}async getLayout(){return this.get("layout")}async getLiveEndTime(){return this.get("liveEndTime")}async getLiveStartTime(){return this.get("liveStartTime")}async getLiveState(){return this.get("liveState")}async getPictureInPicturePosition(){return this.get("pipPosition")}async getPlaybackRate(){return this.get("playbackRate")}async getPlaybackRates(){return this.get("playbackRates")}async getPresentation(){return this.get("presentation")}async getPrimaryContent(){return this.get("primaryContent")}async getSideBySideRatio(){return this.get("sideBySideRatio")}async getVolume(){return this.get("volume")}async isPaused(){return this.get("paused")}pause(){this.command("pause")}play(){this.command("play")}removeEventListener(t,e){if(!t)throw new TypeError("You must pass an event name.");this.callbackStore.removeCallback(`event:${t}`,e),0===this.callbackStore.getCallbacks(`event:${t}`).length&&this.postMessage({action:"event",guid:this.guid,name:t,value:"remove"})}setCurrentTime(t){if(t<0)throw new Error("The current time must be superior or equal to 0");this.set("currentTime",t)}setLayout(t){this.set("layout",t)}setPictureInPicturePosition(t){this.set("pipPosition",t)}setPlaybackRate(t){if(t<0)throw new Error("The playback rate must be superior or equal to 0");if(t>2)throw new Error("The playback rate must be inferior or equal to 2");this.set("playbackRate",t)}setPrimaryContent(t){this.set("primaryContent",t)}setSideBySideRatio(t){if(t<50||t>80)throw new Error("The ratio must be between 50 and 80");this.set("sideBySideRatio",t)}setVolume(t){if(t<0||t>100)throw new Error("The volume must be between 0 and 100");this.set("volume",t)}command(t,e){const i={action:"command",guid:this.guid,name:t};e&&(i.value=e),this.postMessage(i)}get(t){var e=this;return new Promise(async function(i,s){try{await e.readyPromise,e.callbackStore.storeCallback(`get:${t}`,{reject:s,resolve:i}),e.postMessage({action:"get",guid:e.guid,name:t})}catch(t){s(t)}})}postMessage(e){var i;const s=JSON.stringify(t({},e,{version:this.version}));null==(i=this.iframe.contentWindow)||i.postMessage(s,this.origin)}processData(t){const i=e(t);let s=[];if((null==i?void 0:i.version)===this.version&&(null==i?void 0:i.guid)===this.guid){if("event"===i.action)s=this.callbackStore.getCallbacks(`${i.action}:${i.name}`);else if("get"===i.action||"set"===i.action){const t=this.callbackStore.shiftCallback(`${i.action}:${i.name}`);t&&s.push(t)}s.forEach(t=>{"function"==typeof t?t(i.value):t.resolve(i.value)})}}set(t,e){if(void 0===e)throw new TypeError("A value must be set.");this.readyPromise.then(()=>{this.postMessage({action:"set",guid:this.guid,name:t,value:e})})}}export{s as PlayerSdk};
//# sourceMappingURL=index.modern.mjs.map
