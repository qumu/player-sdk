function o(){return o=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(i[a]=t[a])}return i},o.apply(this,arguments)}function u(i){if(typeof i=="string")try{i=JSON.parse(i)}catch{return{}}return i}class l{constructor(){this.map=new Map}getCallbacks(e){return this.map.get(e)||[]}removeCallback(e,t){const a=this.map.get(e)||[];if(!a)return;if(!t)return void this.map.delete(e);const s=a.indexOf(t);s!==-1&&a.splice(s,1),a.length===0?this.map.delete(e):this.map.set(e,a)}shiftCallback(e){const t=this.getCallbacks(e);if(t.length===0)return;const a=t.shift();return this.removeCallback(e,a),a}storeCallback(e,t){const a=this.map.get(e)||[];a.push(t),this.map.set(e,a)}}class h{constructor(e){this.iframe=void 0,this.callbackStore=void 0,this.guid=void 0,this.messageHandler=void 0,this.originUrl=void 0,this.origin="*",this.readyPromise=void 0,this.version=3,this.iframe=e,this.originUrl=new URL(this.iframe.src).origin,this.guid=crypto.randomUUID(),this.callbackStore=new l,this.readyPromise=new Promise(t=>{this.messageHandler=a=>{if(a.origin!==this.originUrl)return;const s=u(a.data);return s?.version!==this.version||s?.action==="handshake"&&s?.guid!==this.guid?void 0:s?.action==="ready"||s?.action==="handshake"?(this.origin=a.origin,void t()):void this.processData(s)},window.addEventListener("message",this.messageHandler)}),this.postMessage({action:"handshake",guid:this.guid})}addEventListener(e,t){if(!e)throw new TypeError("You must pass an event name.");if(!t)throw new TypeError("You must pass a callback function.");if(typeof t!="function")throw new TypeError("The callback must be a function.");this.callbackStore.getCallbacks(`event:${e}`).length===0&&this.readyPromise.then(()=>{this.postMessage({action:"event",guid:this.guid,name:e,value:"add"})}),this.callbackStore.storeCallback(`event:${e}`,t)}destroy(){this.messageHandler&&window.removeEventListener("message",this.messageHandler),this.postMessage({action:"command",guid:this.guid,name:"destroy"})}disableCaptionTrack(){this.enableCaptionTrack(null)}enableCaptionTrack(e){this.set("captionTrack",e)}async getCaptionTracks(){return this.get("captionTracks")}async getChapters(){return this.get("chapters")}async getCurrentChapter(){return this.get("chapter")}async getCurrentCaptionTrack(){return this.get("captionTrack")}async getCurrentTime(){return this.get("currentTime")}async getDuration(){return this.get("duration")}async getLayout(){return this.get("layout")}async getLiveEndTime(){return this.get("liveEndTime")}async getLiveStartTime(){return this.get("liveStartTime")}async getLiveState(){return this.get("liveState")}async getPictureInPicturePosition(){return this.get("pipPosition")}async getPlaybackRate(){return this.get("playbackRate")}async getPlaybackRates(){return this.get("playbackRates")}async getPresentation(){return this.get("presentation")}async getPrimaryContent(){return this.get("primaryContent")}async getSideBySideRatio(){return this.get("sideBySideRatio")}async getVolume(){return this.get("volume")}async isPaused(){return this.get("paused")}pause(){this.command("pause")}play(){this.command("play")}removeEventListener(e,t){if(!e)throw new TypeError("You must pass an event name.");this.callbackStore.removeCallback(`event:${e}`,t),this.callbackStore.getCallbacks(`event:${e}`).length===0&&this.postMessage({action:"event",guid:this.guid,name:e,value:"remove"})}setCurrentTime(e){if(e<0)throw new Error("The current time must be superior or equal to 0");this.set("currentTime",e)}setLayout(e){this.set("layout",e)}setPictureInPicturePosition(e){this.set("pipPosition",e)}setPlaybackRate(e){if(e<0)throw new Error("The playback rate must be superior or equal to 0");if(e>2)throw new Error("The playback rate must be inferior or equal to 2");this.set("playbackRate",e)}setPrimaryContent(e){this.set("primaryContent",e)}setSideBySideRatio(e){if(e<50||e>80)throw new Error("The ratio must be between 50 and 80");this.set("sideBySideRatio",e)}setVolume(e){if(e<0||e>100)throw new Error("The volume must be between 0 and 100");this.set("volume",e)}command(e,t){const a={action:"command",guid:this.guid,name:e};t&&(a.value=t),this.postMessage(a)}async get(e){return await this.readyPromise,new Promise((t,a)=>{try{this.callbackStore.storeCallback(`get:${e}`,{reject:a,resolve:t}),this.postMessage({action:"get",guid:this.guid,name:e})}catch(s){a(s)}})}postMessage(e){var t;const a=JSON.stringify(o({},e,{version:this.version}));(t=this.iframe.contentWindow)==null||t.postMessage(a,this.origin)}processData(e){const t=u(e);let a=[];if(t?.version===this.version&&t?.guid===this.guid){if(t.action==="event")a=this.callbackStore.getCallbacks(`${t.action}:${t.name}`);else if(t.action==="get"||t.action==="set"){const s=this.callbackStore.shiftCallback(`${t.action}:${t.name}`);s&&a.push(s)}a.forEach(s=>{typeof s=="function"?s(t.value):s.resolve(t.value)})}}set(e,t){if(t===void 0)throw new TypeError("A value must be set.");this.readyPromise.then(()=>{this.postMessage({action:"set",guid:this.guid,name:e,value:t})})}}const c=document.querySelector("iframe");let r,n={};c.addEventListener("load",()=>{r=d()});document.getElementById("url").addEventListener("input",i=>{r?.destroy(),n={},c.setAttribute("src",i.target.value)});function d(){const i=new h(c);return document.querySelectorAll('[data-type="event"]').forEach(e=>{const t=e.getAttribute("data-event");n[t]=a=>{console.log(t,a)},e.checked&&i.addEventListener(t,n[t])}),i}document.querySelectorAll('[data-type="get"]').forEach(i=>{i.addEventListener("click",()=>{const e=i.getAttribute("data-command");r[e]().then(t=>console.log(e,t))})});document.querySelectorAll('[data-type="set"]').forEach(i=>{i.addEventListener("click",()=>{const e=i.getAttribute("data-command"),t=i.getAttribute("data-value");r[e](t)})});document.querySelectorAll('[data-type="command"]').forEach(i=>{i.addEventListener("click",()=>{const e=i.getAttribute("data-command");r[e]()})});document.querySelectorAll('[data-type="event"]').forEach(i=>{const e=i.getAttribute("data-event");i.addEventListener("change",t=>{t.currentTarget.checked?r.addEventListener(e,n[e]):r.removeEventListener(e,n[e])})});
