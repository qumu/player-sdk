function o(){return o=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)({}).hasOwnProperty.call(e,i)&&(a[i]=e[i])}return a},o.apply(null,arguments)}function u(a){if(typeof a=="string")try{a=JSON.parse(a)}catch{return{}}return a}class h{constructor(){this.map=new Map}getCallbacks(t){return this.map.get(t)||[]}removeCallback(t,e){const i=this.map.get(t)||[];if(!i)return;if(!e)return void this.map.delete(t);const s=i.indexOf(e);s!==-1&&i.splice(s,1),i.length===0?this.map.delete(t):this.map.set(t,i)}shiftCallback(t){const e=this.getCallbacks(t);if(e.length===0)return;const i=e.shift();return this.removeCallback(t,i),i}storeCallback(t,e){const i=this.map.get(t)||[];i.push(e),this.map.set(t,i)}}class d{constructor(t){this.iframe=void 0,this.callbackStore=void 0,this.guid=void 0,this.messageHandler=void 0,this.originUrl=void 0,this.origin="*",this.readyPromise=void 0,this.version=3,this.iframe=t,this.originUrl=new URL(this.iframe.src).origin,this.guid=crypto.randomUUID(),this.callbackStore=new h,this.readyPromise=new Promise(e=>{this.messageHandler=i=>{if(i.origin!==this.originUrl)return;const s=u(i.data);if(s?.version===this.version&&(s?.action!=="handshake"||s?.guid===this.guid))if(s?.action!=="ready"){if(s?.action==="handshake")return this.origin=i.origin,void e();this.processData(s)}else{const l=s.value?window.document.querySelector(`iframe[src="${s.value}"]`):this.iframe;l?l===this.iframe&&(this.origin=i.origin,e()):console.error("[Qumu Cloud Player SDK]","A Qumu Cloud player is ready but it is impossible to find the corresponding iFrame, the SDK will not work correctly. Incorrect URL is:",s.value)}},window.addEventListener("message",this.messageHandler)}),this.postMessage({action:"handshake",guid:this.guid})}addEventListener(t,e){if(!t)throw new TypeError("You must pass an event name.");if(!e)throw new TypeError("You must pass a callback function.");if(typeof e!="function")throw new TypeError("The callback must be a function.");this.callbackStore.getCallbacks(`event:${t}`).length===0&&this.readyPromise.then(()=>{this.postMessage({action:"event",guid:this.guid,name:t,value:"add"})}),this.callbackStore.storeCallback(`event:${t}`,e)}destroy(){this.messageHandler&&window.removeEventListener("message",this.messageHandler),this.postMessage({action:"command",guid:this.guid,name:"destroy"})}disableCaptionTrack(){this.enableCaptionTrack(null)}enableCaptionTrack(t){this.set("captionTrack",t)}async getCaptionTracks(){return this.get("captionTracks")}async getChapters(){return this.get("chapters")}async getCurrentChapter(){return this.get("chapter")}async getCurrentCaptionTrack(){return this.get("captionTrack")}async getCurrentTime(){return this.get("currentTime")}async getDuration(){return this.get("duration")}async getLayout(){return this.get("layout")}async getLiveEndTime(){return this.get("liveEndTime")}async getLiveStartTime(){return this.get("liveStartTime")}async getLiveState(){return this.get("liveState")}async getPictureInPicturePosition(){return this.get("pipPosition")}async getPlaybackRate(){return this.get("playbackRate")}async getPlaybackRates(){return this.get("playbackRates")}async getPresentation(){return this.get("presentation")}async getPrimaryContent(){return this.get("primaryContent")}async getSideBySideRatio(){return this.get("sideBySideRatio")}async getVolume(){return this.get("volume")}async isPaused(){return this.get("paused")}pause(){this.command("pause")}play(){this.command("play")}removeEventListener(t,e){if(!t)throw new TypeError("You must pass an event name.");this.callbackStore.removeCallback(`event:${t}`,e),this.callbackStore.getCallbacks(`event:${t}`).length===0&&this.postMessage({action:"event",guid:this.guid,name:t,value:"remove"})}setCurrentTime(t){if(t<0)throw new Error("The current time must be superior or equal to 0");this.set("currentTime",t)}setLayout(t){this.set("layout",t)}setPictureInPicturePosition(t){this.set("pipPosition",t)}setPlaybackRate(t){if(t<0)throw new Error("The playback rate must be superior or equal to 0");if(t>2)throw new Error("The playback rate must be inferior or equal to 2");this.set("playbackRate",t)}setPrimaryContent(t){this.set("primaryContent",t)}setSideBySideRatio(t){if(t<50||t>80)throw new Error("The ratio must be between 50 and 80");this.set("sideBySideRatio",t)}setVolume(t){if(t<0||t>100)throw new Error("The volume must be between 0 and 100");this.set("volume",t)}command(t,e){const i={action:"command",guid:this.guid,name:t};e&&(i.value=e),this.postMessage(i)}async get(t){return await this.readyPromise,new Promise((e,i)=>{try{this.callbackStore.storeCallback(`get:${t}`,{reject:i,resolve:e}),this.postMessage({action:"get",guid:this.guid,name:t})}catch(s){i(s)}})}postMessage(t){var e;const i=JSON.stringify(o({},t,{version:this.version}));(e=this.iframe.contentWindow)==null||e.postMessage(i,this.origin)}processData(t){const e=u(t);let i=[];if(e?.version===this.version&&e?.guid===this.guid){if(e.action==="event")i=this.callbackStore.getCallbacks(`${e.action}:${e.name}`);else if(e.action==="get"||e.action==="set"){const s=this.callbackStore.shiftCallback(`${e.action}:${e.name}`);s&&i.push(s)}i.forEach(s=>{typeof s=="function"?s(e.value):s.resolve(e.value)})}}set(t,e){if(e===void 0)throw new TypeError("A value must be set.");this.readyPromise.then(()=>{this.postMessage({action:"set",guid:this.guid,name:t,value:e})})}}const c=document.querySelector("iframe");let r,n={};c.addEventListener("load",()=>{r=g()});document.getElementById("url").addEventListener("input",a=>{r?.destroy(),n={},c.setAttribute("src",a.target.value)});function g(){const a=new d(c);return document.querySelectorAll('[data-type="event"]').forEach(t=>{const e=t.getAttribute("data-event");n[e]=i=>{console.log(e,i)},t.checked&&a.addEventListener(e,n[e])}),a}document.querySelectorAll('[data-type="get"]').forEach(a=>{a.addEventListener("click",()=>{const t=a.getAttribute("data-command");r[t]().then(e=>console.log(t,e))})});document.querySelectorAll('[data-type="set"]').forEach(a=>{a.addEventListener("click",()=>{const t=a.getAttribute("data-command"),e=a.getAttribute("data-value");r[t](e)})});document.querySelectorAll('[data-type="command"]').forEach(a=>{a.addEventListener("click",()=>{const t=a.getAttribute("data-command");r[t]()})});document.querySelectorAll('[data-type="event"]').forEach(a=>{const t=a.getAttribute("data-event");a.addEventListener("change",e=>{e.currentTarget.checked?r.addEventListener(t,n[t]):r.removeEventListener(t,n[t])})});
